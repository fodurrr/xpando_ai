# Story 1.4: LiveView Dashboard & Network Visualization

## Status
**Draft**

## Story
**As a node operator,**
**I want a real-time web dashboard showing network status and node activity,**
**so that I can monitor my node's participation and the overall network health.**

## Acceptance Criteria
1. Phoenix LiveView dashboard displaying real-time network topology
2. DaisyUI components providing consistent, attractive interface elements
3. Interactive network graph showing connected nodes and connection status
4. Individual node detail views with status, uptime, and basic metrics
5. Real-time updates via WebSocket connections without page refresh
6. Responsive design working on desktop, tablet, and mobile devices
7. Basic navigation structure supporting future feature additions

## Tasks / Subtasks
- [ ] Set up Phoenix LiveView dashboard structure (AC: 1, 7)
  - [ ] Create DashboardLive module at `apps/xpando_web/lib/xpando_web_web/live/dashboard_live.ex`
  - [ ] Add dashboard route to router with authentication
  - [ ] Create basic dashboard layout using DaisyUI grid components
  - [ ] Set up PubSub subscription for real-time network updates
- [ ] Implement DaisyUI component library integration (AC: 2)
  - [ ] Create reusable UI components in `apps/xpando_web/lib/xpando_web_web/components/ui/`
  - [ ] Build NodeCard component for node display using DaisyUI card components
  - [ ] Create NetworkStats component with DaisyUI stat components
  - [ ] Add theme selection functionality with DaisyUI themes
- [ ] Build interactive network topology visualization (AC: 3)
  - [ ] Create NetworkGraph LiveComponent with SVG-based node visualization
  - [ ] Implement node positioning algorithm for clear layout
  - [ ] Add connection lines showing P2P node relationships
  - [ ] Include real-time node status updates (online/offline/connecting)
- [ ] Create individual node detail views (AC: 4)
  - [ ] Build NodeDetail LiveComponent with comprehensive metrics display
  - [ ] Show node uptime, reputation score, and specializations
  - [ ] Display connection health statistics and heartbeat data
  - [ ] Add node performance metrics and recent activity log
- [ ] Implement real-time WebSocket updates (AC: 5)
  - [ ] Enhance existing NodeChannel to support dashboard events
  - [ ] Set up PubSub topics for dashboard-specific updates ("dashboard:network_updates", "dashboard:node_status")
  - [ ] Handle real-time node connection/disconnection events
  - [ ] Update UI components without full page refresh using LiveView assigns
- [ ] Add responsive design for all devices (AC: 6)
  - [ ] Implement responsive grid layouts using DaisyUI responsive classes
  - [ ] Optimize network graph for mobile viewing with touch interactions
  - [ ] Create mobile-friendly navigation using DaisyUI drawer component
  - [ ] Test across desktop, tablet, and mobile screen sizes
- [ ] Create comprehensive testing suite (All ACs)
  - [ ] Unit tests for all LiveView components
  - [ ] Integration tests for real-time update functionality
  - [ ] Browser-based tests for responsive design using Wallaby
  - [ ] E2E tests for complete dashboard user workflows
- [ ] Implement Playwright MCP testing suite (All ACs)
  - [ ] Use `mcp__playwright__browser_navigate` for dashboard navigation testing
  - [ ] Capture accessibility snapshots with `mcp__playwright__browser_snapshot`
  - [ ] Visual regression testing with `mcp__playwright__browser_take_screenshot`
  - [ ] Interactive component testing with `mcp__playwright__browser_click` and `mcp__playwright__browser_fill_form`
  - [ ] Real-time update validation with `mcp__playwright__browser_wait_for`
  - [ ] Console error monitoring with `mcp__playwright__browser_console_messages`
  - [ ] Network request validation with `mcp__playwright__browser_network_requests`
- [ ] Add accessibility compliance validation (AC: 6)
  - [ ] ARIA attribute verification for all interactive elements
  - [ ] Keyboard navigation testing with `mcp__playwright__browser_press_key`
  - [ ] Screen reader compatibility testing using accessibility snapshots
  - [ ] WCAG color contrast compliance verification
  - [ ] Focus management testing for LiveView interactions
  - [ ] Touch interaction testing for mobile devices

## Dev Notes

### Previous Story Insights
From Story 1.3 completion:
- P2P infrastructure fully operational with NodeChannel and PubSub integration
- Network topology tracking implemented in `XPando.Node.Manager`
- Real-time messaging system established with Phoenix Channels
- NodeChannel handles P2P events on topics: "network:updates", "network:topology", "node:heartbeat"
- Authentication system integrated with AshAuthentication JWT tokens
- 146 tests passing with comprehensive P2P validation

### Frontend Architecture Context
From [Source: architecture/frontend-architecture.md]:
- **Component Organization**: LiveView files go in `apps/xpando_web/lib/xpando_web_web/live/`
  - Dashboard structure: `dashboard_live/index.ex` with components in `dashboard_live/components/`
  - Component organization: Reusable UI components in `components/ui/`
- **LiveView State Management**: Server-side state via assigns, real-time updates through Phoenix PubSub
- **State Structure**: Connected LiveView subscribes to PubSub topics, uses :timer.send_interval for periodic updates
- **Route Organization**: Dashboard routes protected with authentication pipelines

### Tech Stack Integration 
From [Source: architecture/tech-stack.md]:
- **Frontend Framework**: Phoenix LiveView 1.1+ for real-time server-rendered UI
- **UI Component Library**: DaisyUI 4.12.14 with Tailwind CSS integration
- **State Management**: LiveView built-in server-side state management
- **Frontend Testing**: ExUnit + Wallaby for LiveView and browser automation tests
- **Asset Bundling**: ESBuild 0.10.0 for JavaScript/CSS bundling

### DaisyUI Component Integration
From [Source: architecture/frontend-architecture.md]:
- **Card Components**: Use `card`, `card-body`, `card-title` classes for node displays
- **Stats Components**: DaisyUI `stats`, `stat`, `stat-title`, `stat-value` for metrics
- **Navigation**: DaisyUI `navbar` and `drawer` components for responsive navigation
- **Theme Support**: Built-in DaisyUI theme switching capability
- **Grid System**: DaisyUI responsive grid classes for layout structure

### Project Structure Requirements
From [Source: architecture/unified-project-structure.md]:
- **LiveView Location**: `apps/xpando_web/lib/xpando_web_web/live/`
  - Dashboard: `dashboard_live/index.ex`
  - Components: `dashboard_live/components/network_stats.ex`, `dashboard_live/components/inference_panel.ex`
- **UI Components**: `apps/xpando_web/lib/xpando_web_web/components/ui/`
  - `node_card.ex`, `knowledge_graph.ex`, `contribution_list.ex`
- **Assets**: `apps/xpando_web/assets/css/` and `apps/xpando_web/assets/js/`

### Authentication and Routing
From [Source: architecture/frontend-architecture.md]:
- **Protected Routes**: Dashboard requires authentication using `require_authenticated_user` pipeline
- **Route Definition**: `live "/", DashboardLive.Index, :index` with authentication
- **Session Management**: AshAuthentication integration with JWT tokens
- **Route Organization**: Main routes in browser pipeline, API routes separate

### Real-time Data Integration
From Story 1.3 context and [Source: architecture/frontend-architecture.md]:
- **P2P Data Access**: Use `XPando.Node.Manager` API for network topology data
- **PubSub Topics**: Subscribe to existing "network:updates", "network:topology" topics
- **NodeChannel Integration**: Dashboard can reuse existing NodeChannel for real-time updates
- **Data Flow**: LiveView mount → PubSub subscribe → handle_info for real-time updates

### Network Visualization Requirements
From Acceptance Criteria and [Source: architecture/components.md]:
- **Interactive Network Graph**: SVG-based visualization showing node connections
- **Node Display**: Each node shows name, status (online/offline/syncing), reputation score
- **Connection Lines**: Visual representation of P2P connections between nodes
- **Real-time Updates**: Graph updates automatically as nodes join/leave network

### Coding Standards for LiveView
From [Source: architecture/coding-standards.md]:
- **LiveView Modules**: PascalCase + "Live" suffix (DashboardLive)
- **Components**: PascalCase naming (NodeCard, NetworkStats)
- **Error Boundaries**: Every LiveView must implement handle_error callbacks
- **LiveView State**: Never store sensitive data in assigns, use ETS for large datasets
- **PubSub Topics**: Use colon-separated naming ("dashboard:updates")

### Testing Requirements
From [Source: architecture/testing-strategy.md]:
- **Test Organization**: Frontend tests in `apps/xpando_web/test/xpando_web_web/live/`
- **Test Types**: 70% unit tests, 25% integration tests, 5% E2E tests
- **LiveView Testing**: Use Phoenix.LiveViewTest for component testing
- **Browser Testing**: Wallaby for E2E responsive design testing
- **Test Structure**: Tests in `dashboard_live_test.exs`, component tests in `components/` subdirectory

### Data Models Integration
From [Source: architecture/data-models.md] and existing Node resource:
- **Node Attributes**: id, name, status, specializations, reputation_score, last_heartbeat, wallet_address
- **Status Tracking**: Node.status enum (online/offline/syncing)
- **Network Relationships**: Node has relationships with Knowledge and Contribution resources
- **Real-time Data**: Access node metrics through Ash Resource queries and PubSub updates

### Component Template Reference
From [Source: architecture/frontend-architecture.md]:
```elixir
defmodule XPandoWeb.Components.NodeCard do
  use XPandoWeb, :live_component
  # Component implementation with DaisyUI classes
  # "card bg-base-100 shadow-xl", "badge badge-secondary"
end
```

### Technical Constraints
From [Source: architecture/tech-stack.md]:
- **Phoenix Version**: 1.8.0 with LiveView 1.1+ integration
- **Responsive Design**: Must work on desktop, tablet, mobile screen sizes  
- **Performance**: Real-time updates without page refresh, sub-500ms response times
- **Authentication**: Integrated with existing ash_authentication system

## Testing

### Testing Standards
From [Source: architecture/testing-strategy.md] + Frontend Design Principles:
- **Test File Locations**: 
  - `apps/xpando_web/test/xpando_web_web/live/dashboard_live_test.exs`
  - `apps/xpando_web/test/xpando_web_web/components/node_card_test.exs`
  - `apps/xpando_web/test/xpando_web_web/components/network_stats_test.exs`
- **Testing Frameworks**: ExUnit with Phoenix.LiveViewTest for LiveView testing
- **Browser Testing**: Wallaby with headless Chrome for responsive design validation
- **Playwright MCP Testing**: Use MCP server tools for comprehensive frontend testing
- **Test Structure**: Use XPandoWeb.ConnCase for LiveView tests, proper fixtures for node data

### Playwright MCP Testing Approach
From Frontend Design Principles integration:
- **Navigation Testing**: `mcp__playwright__browser_navigate` for dashboard routing validation
- **Accessibility Validation**: `mcp__playwright__browser_snapshot` for accessibility tree verification
- **Visual Regression**: `mcp__playwright__browser_take_screenshot` for UI consistency checks
- **Interactive Testing**: `mcp__playwright__browser_click`, `mcp__playwright__browser_fill_form` for component interactions
- **Real-time Monitoring**: `mcp__playwright__browser_wait_for` for LiveView update validation
- **Error Detection**: `mcp__playwright__browser_console_messages` for JavaScript error monitoring
- **Network Validation**: `mcp__playwright__browser_network_requests` for API call verification

### Accessibility Testing Requirements
From Frontend Design Principles compliance:
- **ARIA Verification**: All interactive elements must have proper ARIA labels and roles
- **Keyboard Navigation**: `mcp__playwright__browser_press_key` testing for full keyboard accessibility
- **Screen Reader Compatibility**: Accessibility snapshots must show proper semantic structure
- **Color Contrast**: WCAG compliance verification for all text/background combinations
- **Focus Management**: LiveView interactions must maintain proper focus indicators
- **Touch Accessibility**: Mobile touch targets must meet minimum size requirements (44x44px)

### Testing Patterns Required
- **LiveView Component Tests**: Test rendering, state updates, PubSub message handling
- **Integration Tests**: Test real-time updates from NodeChannel and PubSub events
- **Responsive Design Tests**: Multi-device testing with Playwright MCP browser resizing
- **Authentication Tests**: Verify dashboard requires authentication, proper redirects
- **Visual Regression Tests**: Baseline screenshot comparisons for UI consistency
- **Accessibility Compliance Tests**: Full WCAG 2.1 AA compliance validation

### Playwright MCP Testing Examples
Following Frontend Design Principles testing patterns:

```javascript
// 1. Dashboard Navigation and Layout Testing
mcp__playwright__browser_navigate({ url: "http://localhost:4000/dashboard" })
mcp__playwright__browser_resize({ width: 1920, height: 1080 })
mcp__playwright__browser_snapshot() // Capture desktop layout accessibility tree

// 2. DaisyUI Component Interaction Testing
mcp__playwright__browser_click({
  element: "Theme toggle button",
  ref: "button[data-theme-toggle]"
})
mcp__playwright__browser_wait_for({ text: "Dark theme activated" })

// 3. Real-time Network Updates Testing
mcp__playwright__browser_wait_for({ text: "Node online" })
mcp__playwright__browser_take_screenshot({
  filename: "network-graph-online-state.png",
  element: "Network visualization",
  ref: "#network-graph"
})

// 4. Responsive Design Testing
mcp__playwright__browser_resize({ width: 375, height: 667 }) // iPhone SE
mcp__playwright__browser_click({
  element: "Mobile navigation drawer",
  ref: "button[data-drawer-toggle]"
})
mcp__playwright__browser_snapshot() // Verify mobile accessibility

// 5. Form Interaction Testing (if applicable)
mcp__playwright__browser_fill_form({
  fields: [
    { name: "Node filter", ref: "input[name='node_filter']", type: "textbox", value: "online" }
  ]
})
mcp__playwright__browser_wait_for({ text: "Filtering nodes by: online" })

// 6. Console Error and Network Monitoring
mcp__playwright__browser_console_messages() // Check for JavaScript errors
mcp__playwright__browser_network_requests() // Verify WebSocket connections

// 7. Keyboard Navigation Testing
mcp__playwright__browser_press_key({ key: "Tab" })
mcp__playwright__browser_press_key({ key: "Enter" })
// Verify focus management and keyboard accessibility
```

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-29 | 1.0 | Initial story creation with complete architecture context and detailed implementation tasks | Bob (SM) |
| 2025-08-29 | 1.1 | Enhanced testing suite with Playwright MCP tools integration and accessibility compliance validation following Frontend Design Principles | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
- N/A

### Debug Log References
- N/A

### Completion Notes List
- N/A

### File List
- N/A

## QA Results
- N/A